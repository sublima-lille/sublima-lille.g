/*
 * Smoothproducts
 * http://kthornbloom.com/smoothproducts.php
 *
 * Copyright 2013, Kevin Thornbloom
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
!function(t){t.fn.extend({smoothproducts:function(){var e=300;t(".sp-wrap").append('<div class="sp-large"></div><div class="sp-thumbs sp-tb-active"></div>'),t(".sp-wrap").each(function(){t("a",this).appendTo(t(".sp-thumbs",this)),t(".sp-thumbs a:first",this).addClass("sp-current").clone().removeClass("sp-current").appendTo(t(".sp-large",this)).addClass("sp-current-big"),t(".sp-wrap").css({display:"inline-block"})}),t(document.body).on("click",".sp-thumbs",function(t){t.preventDefault()}),t(document.body).on("click",".sp-tb-active a",function(s){t(this).parent().find(".sp-current").removeClass(),t(this).parent().parent().find(".sp-thumbs").removeClass("sp-tb-active"),t(this).parent().parent().find(".sp-zoom").remove(),t(this).parent().parent().find(".sp-full-screen").fadeOut(function(){t(this).remove()});var a=t(this).parent().parent().find(".sp-large").height(),n=t(this).parent().parent().find(".sp-large").width();t(this).parent().parent().find(".sp-large").css({overflow:"hidden",height:a+"px",width:n+"px"}),t(this).parent().parent().find(".sp-large a").remove(),t(this).addClass("sp-current").clone().hide().removeClass("sp-current").appendTo(t(this).parent().parent().find(".sp-large")).addClass("sp-current-big").fadeIn(e,function(){var e=t(this).parent().parent().find(".sp-large img").height();t(this).parent().parent().find(".sp-large").animate({height:e},"fast",function(){t(".sp-large").css({height:"auto",width:"auto"})}),t(this).parent().parent().find(".sp-thumbs").addClass("sp-tb-active")}),s.preventDefault()}),t(document.body).on("mouseover",".sp-large a",function(e){var s=t(this).attr("href");t(this).parent().parent().find(".sp-large").append('<div class="sp-zoom"><img src="'+s+'"/></div>'),t(this).parent().parent().find(".sp-zoom").fadeIn(),t(this).parent().parent().find(".sp-zoom").draggable(),e.preventDefault()});var s=t(".sp-thumbs a:first").attr("href");t(".sp-full-screen a").attr("href",s),t(".sp-thumbs a").click(function(){var e=t(this).attr("href");t(".sp-full-screen a").attr("href",e)}),t(".sp-large").mousemove(function(e){var s=t(this).width(),a=t(this).height(),n=t(this).find(".sp-zoom").width(),i=t(this).find(".sp-zoom").height(),p=t(this).parent().offset(),r=e.pageX-p.left,o=e.pageY-p.top,h=Math.floor(r*(s-n)/s),d=Math.floor(o*(a-i)/a);t(this).find(".sp-zoom").css({left:h,top:d})}).mouseout(function(){}),t.fn.draggable=function(){var e=null,s=function(s){var a=s.originalEvent,n=t(this).position();e={x:a.changedTouches[0].pageX-n.left,y:a.changedTouches[0].pageY-n.top}},a=function(s){s.preventDefault();var a=s.originalEvent,n=a.changedTouches[0].pageY-e.y,i=a.changedTouches[0].pageX-e.x,p=-1*(t(".sp-zoom").height()-t(".sp-large").height()),r=-1*(t(".sp-zoom").width()-t(".sp-large").width());n>p&&0>n&&t(this).css({top:n}),i>r&&0>i&&t(this).css({left:i})};this.bind("touchstart",s),this.bind("touchmove",a)},t(document.body).on("mouseleave",".sp-zoom",function(e){t(this).fadeOut(function(){t(this).remove()})})}})}(jQuery);